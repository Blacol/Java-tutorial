# 实践3-简单的师生管理系统

## 实践前置要求

- [ ] 完成第12章内容

## 实践内容

设计一款简单的能表示师生关系的一个管理系统。

## 需求

1. 可以对教师增删改查
2. 可以对学生增删改查
3. 可以对学生和教师间的关系进行增删改查。

## 程序实现

### 创建项目

1. 创建普通Java项目
2. 创建好包`com.[你的名字].entity`、`com.[你的名字].core`

### 编码

1. 在`entity`包下创建类`People`，这里我们将`People`类作为密闭类，然后限定`Teacher`和`Student`类继承它

   ```java
   public sealed class People permits Teacher,Student {
       private String name;
       private int age;
       private char gender;
       //Getter和Setter
   }
   ```

2. 再在`entity`包下创建`Student`类和`Teacher`类

   ```java
   public non-sealed class Student extends People{
       private String sid;
       private String clazz;//班级
       //Getter和Setter
   }
   ```

   ```java
   public non-sealed class Teacher extends People {
       private String tid;
       //Getter和Setter
   }
   ```

3. 再在`entity`包下创建`TeacherStudentRelation`类以表示学生和教师之间的关系

   ```java
   public class TeacherStudentRelation {
       private String id;
       private Teacher teacher;
       private Student student;
       //Getter和Setter
   }
   ```

4. 在`core`包下创建`StudentCore`，我们可以从实践2中复制一份`StudentCore`放到实践3中的`core`包中并稍作修改：

   将`StudentCore`中的`setId()`改成`setSid()`，`getId()`改成`getSid()`。

   我们可以在IDEA中按ctrl+R键弹出替换框，在上面那一栏输入`setId`，在下面那一栏输入`setSid`然后点击全部替换IDEA就会把所有`setId`替换为`setSid`。同样的`getId`也可以这样快速修改。

5. 将实践2中`core`包下的`StudentCore`复制一份并改名为`TeacherCore`然后稍作修改。

   右键`StudentCore`按ctrl+c再按ctrl+v在弹出的界面中将`StudentCore`改为`TeacherCore`

   右键`Student[] students`中的`Student[]`，选择重构->类型迁移，在弹出的界面将`Student[]`换成`Teacher[]`然后按回车，这样`students`的类型就改为了`Teacher`。当然，只改了类型不改名字看着也怪怪的，我们右键`students`，选择重构->重命名，然后将`students`改成`teachers`然后按回车，这样所有的名为`students`的对象都变成名为`teachers`的对象了。

6. 在`core`包下创建`RelationCore`以表示学生与教师之间的关系

   ```java
   public class RelationCore {
       private Scanner scanner=new Scanner(System.in);
       private TeacherStudentRelation[] relations=new TeacherStudentRelation[10];
       //创建教师和学生的关系
       public void createRelation(Student[] students, Teacher[] teachers){
           System.out.println("请输入教师的工号");
           String tid = scanner.next();
           System.out.println("请输入学生的学号");
           String sid=scanner.next();
           for (Student s:students){
               if (s.getSid().equals(sid)){
                   for (Teacher t:teachers){
                       if (t.getTid().equals(tid)){
                           System.out.println("请输入关系编号：");
                           String rid = scanner.next();
                           TeacherStudentRelation relation=new TeacherStudentRelation();//设置师生关系
                           relation.setStudent(s);
                           relation.setTeacher(t);
                           relation.setId(rid);
                           for (int i=0;i<relations.length;i++){
                               if (relations[i]==null){
                                   relations[i]=relation;
                                   return;
                               }
                           }
                           relations[relations.length-1]=relation;
                           return;
                       }
                   }
                   System.out.printf("没有工号为%s的教师",tid);
               }
           }
           System.out.printf("没有学号为%s的学生",sid);
       }
       //更新教师和学生的关系
       public void updateRelation(Student[] students, Teacher[] teachers){
           System.out.println("请输入关系编号");
           String rid = scanner.next();
           for (int i=0;i< relations.length;i++){
               if (relations[i].getId().equals(rid)){
                   System.out.println("请输入新的学生编号，保持不变输入NO");
                   String newSid = scanner.next();
                   System.out.println("请输入新的教师编号，保持不变输入NO");
                   String newTid=scanner.next();
                   Student newStudent=null;
                   Teacher newTeacher=null;
                   boolean findStudent=false;
                   boolean findTeacher=false;
                   if (!newSid.equals("NO")){
                       for (Student s:students){
                           if (s.getSid().equals(newSid)){
                               newStudent=s;
                               findStudent=true;
                               for (Teacher t:teachers){
                                   if (t.getTid().equals(newTid)){
                                       newTeacher=t;
                                       findTeacher=true;
                                   }
                               }
                           }
                       }
                   }else if (!newTid.equals("NO")){
                       for (Teacher t:teachers){
                           if (t.getTid().equals(newTid)){
                               newTeacher=t;
                               findTeacher=true;
                           }
                       }
                   }else{
                       System.out.println("没有修改任何东西！");
                       return;
                   }
                   TeacherStudentRelation relation = relations[i];
                   if (findTeacher&&findStudent){
                       relation.setStudent(newStudent);
                       relation.setTeacher(newTeacher);
                       return;
                   }else if (findTeacher){
                       relation.setTeacher(newTeacher);
                       return;
                   }else if (findStudent){
                       relation.setStudent(newStudent);
                       return;
                   }else{
                       System.out.println("没有找到对应的学生或者老师。");
                       break;
                   }
               }
           }
       }
       //删除关系
       public void deleteRelation(){
           System.out.println("请输入要删除的关系编号");
           String rid = scanner.next();
           for (int i=0;i<relations.length;i++){
               TeacherStudentRelation relation = relations[i];
               if (relation.getId().equals(rid)){
                   relations[i]=null;
                   return;
               }
           }
           System.out.println("没有这个关系");
       }
       //获取关系
       public void checkRelation(){
           System.out.println("请输入要查找的关系编号");
           String rid = scanner.next();
           for (int i=0;i<relations.length;i++){
               TeacherStudentRelation relation = relations[i];
               if (relation!=null&&relation.getId().equals(rid)){
                   System.out.printf("""
                           教师：%s(%s)
                           学生：%s(%s-%s)
                           """,relation.getTeacher().getName(),relation.getTeacher().getTid(),
                           relation.getStudent().getName(),relation.getStudent().getSid(),
                           relation.getStudent().getClazz());
                   return;
               }
               if (i==0&&relation==null){
                   System.out.println("没有这个关系");
                   return;
               }
           }
           System.out.println("没有这个关系");
       }
   }
   ```

   大体思路和实践2中学生的增删改查思路一样，因此不过多叙述。

   结果：

   ```
   12345
   ```

   执行过程：

   1. 遍历数组，取intList的第一个元素并将该元素存入i
   2. 输出i
   3. 取intList的第二个元素并将该元素存入i
   4. 输出i
   5. 不断重复直至遍历完成。

   从数组的第一个元素到数组的最后一个元素每个元素都获取一遍叫遍历。for-each方法用于不需要索引的遍历。比如查询功能。而需要索引的遍历则不适用，比如查找某个元素的索引。

   这里的`Integer`是一个包装类，用来代替`int`基本数据类型。由于for-each中元素的类型必须是引用数据类型，所以需要用`Integer`包装类来表示元素。如果使用基本数据类型会报错。

7. 在`com.[你的名字].sj3`下创建`Main`类并编写代码：

   ```java
   public class Main {
       public static void main(String[] args) {
           StudentCore studentCore=new StudentCore();
           TeacherCore teacherCore=new TeacherCore();
           RelationCore relationCore=new RelationCore();
           while (true){
               System.out.println("""
                   请选择功能：
                   1. 创建学生
                   2. 编辑学生
                   3. 查询学生
                   4. 删除学生
                   5. 创建教师
                   6. 编辑教师
                   7. 查询教师
                   8. 删除教师
                   9. 创建关系
                   10. 编辑关系
                   11. 查询关系
                   12. 删除关系
                   13. 退出
                   """);
               Scanner scanner=new Scanner(System.in);
               int i = scanner.nextInt();
               switch (i){
                   case 1->studentCore.createStudent();
                   case 2-> {
                       System.out.println("请输入要编辑的学生ID：");
                       String id = scanner.next();
                       studentCore.updateStudent(id);
                   }
                   case 3->{
                       System.out.println("请输入要查询的学生ID：");
                       String id = scanner.next();
                       studentCore.checkStudent(id);
                   }
                   case 4->{
                       System.out.println("请输入要删除的学生ID：");
                       String id = scanner.next();
                       studentCore.deleteStudent(id);
                   }
                   case 5->teacherCore.createTeacher();
                   case 6-> {
                       System.out.println("请输入要编辑的教师ID：");
                       String id = scanner.next();
                       teacherCore.updateTeacher(id);
                   }
                   case 7->{
                       System.out.println("请输入要查询的教师ID：");
                       String id = scanner.next();
                       teacherCore.checkTeacher(id);
                   }
                   case 8->{
                       System.out.println("请输入要删除的教师ID：");
                       String id = scanner.next();
                       teacherCore.deleteTeacher(id);
                   }
                   case 9->relationCore.createRelation(studentCore.getStudents(), teacherCore.getTeachers());
                   case 10-> relationCore.updateRelation(studentCore.getStudents(), teacherCore.getTeachers());
                   case 11->relationCore.checkRelation();
                   case 12->relationCore.deleteRelation();
               }
               if (i==13){
                   break;
               }
           }
       }
   }
   ```
